<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="@griznog">
  <link rel="canonical" href="https://docs.scg.stanford.edu/tutorials/job_scripts/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Working with Slurm - SCG</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Working with Slurm";
    var mkdocs_page_input_path = "tutorials/job_scripts.md";
    var mkdocs_page_url = "/tutorials/job_scripts/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-132448515-1', 'login.scg.stanford.edu');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> SCG</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../accounts/">Requesting Accounts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quick_start/">Quick Start</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../uv300/">NIH Supercomputer (UV300)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../covid19/">COVID-19 Access</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../connecting/">Connecting to SCG</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_management/">Managing and Moving Data</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Working with Slurm</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ssh_controlmaster/">Avoiding Duo with SSH</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../gpus/">Using GPUs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">FAQs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/account/">--account=?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/time/">--time=?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/cores/">CPUs/Nodes/Tasks?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/memory/">Memory?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../faqs/oak_migration/">Oak Storage Migration</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../software/">Software</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contact/">Getting Help</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SCG</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials &raquo;</li>
        
      
    
    <li>Working with Slurm</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="why-use-slurm">Why use Slurm?<a class="headerlink" href="#why-use-slurm" title="Permanent link">&para;</a></h1>
<p>Within the SCG cluster, Slurm functions as a resource broker. Submitting a job
to Slurm requests a set of CPU and memory resources. Slurm orders these
requests and gives them a priority based on the cluster configuration and runs
each job on the most appropriate available resource in the order that respects
the job priority or, when possible, squeezes in short jobs via a backfill
scheduler to harvest unused cpu time. Using Slurm allows many users to fairly
share a set of computational resources with greatly reduced danger of
negatively impacting anotehr persons jobs or work while also allowing the
resources to be better and more fully utilized over time.</p>
<p>In addition to making it easier to effectively share a resource, Slurm also
acts as a powerful tool for managing workflows. By encapsulating steps in job
scripts it becomes possible to easily repeat and reuse workflows and having
such job scripts adds to the documentation of the associated process.</p>
<h1 id="what-is-a-job-script">What is a job script?<a class="headerlink" href="#what-is-a-job-script" title="Permanent link">&para;</a></h1>
<p>A job script is a normal unix <a href="https://en.wikipedia.org/wiki/Shell_script">shell
script</a> which optionally contains
lines flagged such that the Slurm submission process can read arguments from
them. A simple <em>hello world</em> job script using Bash would be</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># See `man sbatch` or https://slurm.schedmd.com/sbatch.html for descriptions</span>
<span class="c1"># of sbatch options.</span>
<span class="c1">#SBATCH --job-name=hello_world</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --partition=interactive</span>
<span class="c1">#SBATCH --account=default</span>
<span class="c1">#SBATCH --time=1:00:00</span>

<span class="nb">echo</span> <span class="s1">&#39;Hello World!&#39;</span>
</code></pre></div>
</td></tr></table>

<h1 id="submitting-a-job">Submitting a job<a class="headerlink" href="#submitting-a-job" title="Permanent link">&para;</a></h1>
<p>Saving the script as <code>hello_world.sh</code> and submitting it to Slurm with
<a href="https://slurm.schedmd.com/sbatch.html"><code>sbatch</code></a> results in the job running
and producing an output file. The default output file is
<code>slurm-JOB_ID.out</code> located in the directory from which the job was submitted.
For example:</p>
<div class="codehilite"><pre><span></span><code><span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ sbatch hello_world.sh </span>
<span class="err">Submitted batch job 6592914</span>
<span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ cat slurm-6592914.out</span>
<span class="err">Hello World!</span>
</code></pre></div>


<p>The <a href="https://slurm.schedmd.com/sbatch.html"><code>sbatch</code> man page</a> lists all sbatch options. </p>
<h1 id="managing-slurm-jobs">Managing Slurm Jobs<a class="headerlink" href="#managing-slurm-jobs" title="Permanent link">&para;</a></h1>
<h2 id="squeue">squeue<a class="headerlink" href="#squeue" title="Permanent link">&para;</a></h2>
<p>Once a job is submitted, it either immediately runs if resources are available
and there are no jobs ahead of it in the queue or it is queued and marked as
Pending. Pending and running jobs can be monitored with the 
<a href="https://slurm.schedmd.com/squeue.html"><code>squeue</code></a> command.</p>
<p>The default <a href="https://slurm.schedmd.com/squeue.html"><code>squeue</code></a> output shows all jobs:</p>
<div class="codehilite"><pre><span></span><code><span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ squeue</span>
<span class="err">             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span>
<span class="err">           6564781 interacti     wrap   crolle PD       0:00      1 (Resources)</span>
<span class="err">           6564782 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564783 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564784 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564785 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564786 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564787 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564788 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564789 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564790 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564791 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564792 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6592902       dtn seqctr_s     root PD       0:00      1 (BeginTime)</span>
<span class="err">           6564793 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564794 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">           6564795 interacti     wrap   crolle PD       0:00      1 (Priority)</span>
<span class="err">...</span>
</code></pre></div>


<p>Some useful <a href="https://slurm.schedmd.com/squeue.html"><code>squeue</code></a> commands are:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>squeue -u $USER</code></td>
<td>Show only jobs owned by $USER.</td>
</tr>
<tr>
<td><code>squeue -t pd</code></td>
<td>Show only pending jobs. <code>-t r</code> to show only running jobs&rsquo;</td>
</tr>
<tr>
<td><code>squeue -j JOBID</code></td>
<td>Show details for job JOBID.</td>
</tr>
<tr>
<td><code>squeue -j JOBID --format="%m"</code></td>
<td>Use <code>--format</code> to show only the memory requested.</td>
</tr>
</tbody>
</table>
<h2 id="scancel">scancel<a class="headerlink" href="#scancel" title="Permanent link">&para;</a></h2>
<p>The simplest method of cancelling a running job or job array task is to use <a href="https://slurm.schedmd.com/scancel.html"><code>scancel</code></a>. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ squeue -u $USER</span>
<span class="err">             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span>
<span class="err">           6593409 interacti     wrap  griznog PD       0:00      1 (Priority)</span>
<span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ scancel 6593409</span>
<span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ squeue -u $USER</span>
<span class="err">             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span>
<span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ </span>
</code></pre></div>


<p>The <a href="https://slurm.schedmd.com/scancel.html"><code>scancel</code> man page</a> lists the
options to <a href="https://slurm.schedmd.com/scancel.html"><code>scancel</code></a>, many of which
are useful for selecting subsets of jobs to operate on.
<a href="https://slurm.schedmd.com/scancel.html"><code>scancel</code></a> can also be used to send
specific <a href="https://en.wikipedia.org/wiki/Signal_(IPC)">signals</a> to a jobs
processes. This can be useful for more advanced jobs which are designed to
perform different functions in response to receiving a signal, for instance,
applications that can perform a checkpoint might be triggered to do so manually
with a signal sent via <a href="https://slurm.schedmd.com/scancel.html"><code>scancel</code></a>. </p>
<h2 id="sinfo">sinfo<a class="headerlink" href="#sinfo" title="Permanent link">&para;</a></h2>
<p>The <a href="https://slurm.schedmd.com/sinfo.html"><code>sinfo</code></a> command can be used to list available partitions, show status and list node and partition configurations. To list partitions:</p>
<div class="codehilite"><pre><span></span><code><span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ sinfo</span>
<span class="err">PARTITION   AVAIL  TIMELIMIT  NODES  STATE NODELIST</span>
<span class="err">batch*         up 120-00:00:     22    mix dper730xd-srcf-d16-[01,03,05,07,09,11,13,15],dper7425-srcf-d15-13,sgisummit-frcf-111-[08,12,14,16,18,20,24,26,28,34,36,38],sgiuv20-rcf-111-32</span>
<span class="err">batch*         up 120-00:00:      3  alloc sgisummit-frcf-111-[10,22,30]</span>
<span class="err">batch*         up 120-00:00:     24   idle dper730xd-srcf-d16-[17,19,21,23,25,27,29,31,33,35,37,39],dper930-srcf-d15-05,dper7425-srcf-d15-[09,11,15,17,19,21,23,25,27,29,31]</span>
<span class="err">interactive    up 120-00:00:      2 drain* hppsl230s-rcf-412-01-l,hppsl230s-rcf-412-02-l</span>
<span class="err">interactive    up 120-00:00:      5    mix dper910-rcf-412-20,hppsl230s-rcf-412-01-r,hppsl230s-rcf-412-02-r,hppsl230s-rcf-412-03-l,hppsl230s-rcf-412-03-r</span>
<span class="err">interactive    up 120-00:00:     18   idle hppsl230s-rcf-412-04-l,hppsl230s-rcf-412-04-r,hppsl230s-rcf-412-05-l,hppsl230s-rcf-412-05-r,hppsl230s-rcf-412-06-l,hppsl230s-rcf-412-06-r,hppsl230s-rcf-412-07-l,hppsl230s-rcf-412-07-r,hppsl230s-rcf-412-08-l,hppsl230s-rcf-412-08-r,hppsl230s-rcf-412-09-l,hppsl230s-rcf-412-09-r,hppsl230s-rcf-412-10-l,hppsl230s-rcf-412-10-r,hppsl230s-rcf-412-11-l,hppsl230s-rcf-412-11-r,hppsl230s-rcf-412-12-l,hppsl230s-rcf-412-12-r</span>
<span class="err">nih_s10        up 4-00:00:00      1    mix sgiuv300-srcf-d10-01</span>
<span class="err">nih_s10_gpu    up 4-00:00:00      1    mix sgiuv300-srcf-d10-01</span>
<span class="err">dtn            up 120-00:00:      2   idle cfxs2600gz-rcf-114-[06,08]</span>
<span class="err">apps           up 120-00:00:      1   idle dper7425-srcf-d10-37</span>
</code></pre></div>


<h2 id="sacct">sacct<a class="headerlink" href="#sacct" title="Permanent link">&para;</a></h2>
<p>The <a href="https://slurm.schedmd.com/sacct.html"><code>sacct</code></a> command can be used to retrieve infomration about jobs that have completed. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="err">[griznog@smsx10srw-srcf-d15-37 jobs]$ sacct -j  6593409</span>
<span class="err">       JobID    JobName  Partition    Account  AllocCPUS      State ExitCode </span>
<span class="err">------------ ---------- ---------- ---------- ---------- ---------- -------- </span>
<span class="err">6593409            wrap interacti+    default          1 CANCELLED+      0:0 </span>
<span class="err">6593409.bat+      batch               default          1  CANCELLED     0:15 </span>
<span class="err">6593409.ext+     extern               default          1  COMPLETED      0:0 </span>
</code></pre></div>


<p>When troubleshooting jobs, the <em>ExitCode</em> can be useful to determine how the job ended as it shows the exit code of the job script and the signal which caused the process to terminate. For the example above, the job was cancelled and it&rsquo;s script was killed by signal 15 with the job script returning 0.</p>
<p>The <a href="https://slurm.schedmd.com/sacct.html"><code>sacct</code></a> command can return many details about jobs, consult the <a href="https://slurm.schedmd.com/sacct.html"><code>sacct</code> man page</a> for more information about options and values that can be retrieved for jobs.</p>
<h1 id="more-information">More information<a class="headerlink" href="#more-information" title="Permanent link">&para;</a></h1>
<p>For more information about additional Slurm commands, see the <a href="https://slurm.schedmd.com/documentation.html">Slurm documentation</a>. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ssh_controlmaster/" class="btn btn-neutral float-right" title="Avoiding Duo with SSH">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../data_management/" class="btn btn-neutral" title="Managing and Moving Data"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../data_management/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ssh_controlmaster/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
